<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.54">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Data Cleaning – DSAN-5000: Project</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../assets/gu-logo.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">DSAN-5000: Project</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../instructions/overview.html"> 
<span class="menu-text">Instructions</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../report/report.html"> 
<span class="menu-text">Report</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-technical-details" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Technical details</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-technical-details">    
        <li>
    <a class="dropdown-item" href="../../technical-details/data-collection/main.html">
 <span class="dropdown-text">Data-collection</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../technical-details/data-cleaning/main.html">
 <span class="dropdown-text">Data-cleaning</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../technical-details/eda/main.html">
 <span class="dropdown-text">Exploratory Data Analysis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../technical-details/unsupervised-learning/main.html">
 <span class="dropdown-text">Unsupervised Learning</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../technical-details/supervised-learning/main.html">
 <span class="dropdown-text">Supervised Learning</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../technical-details/progress-log.html">
 <span class="dropdown-text">Progress Log</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../technical-details/llm-usage-log.html">
 <span class="dropdown-text">LLM usage Log</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#instructions" id="toc-instructions" class="nav-link active" data-scroll-target="#instructions">Instructions</a>
  <ul class="collapse">
  <li><a href="#introduction-and-motivation" id="toc-introduction-and-motivation" class="nav-link" data-scroll-target="#introduction-and-motivation">Introduction and Motivation</a></li>
  <li><a href="#overview-of-methods" id="toc-overview-of-methods" class="nav-link" data-scroll-target="#overview-of-methods">Overview of Methods</a></li>
  <li><a href="#data-types-and-processing-requirements" id="toc-data-types-and-processing-requirements" class="nav-link" data-scroll-target="#data-types-and-processing-requirements">Data Types and Processing Requirements</a>
  <ul class="collapse">
  <li><a href="#macroeconomic-data" id="toc-macroeconomic-data" class="nav-link" data-scroll-target="#macroeconomic-data">1. Macroeconomic Data</a></li>
  <li><a href="#market-data-technical-indicators" id="toc-market-data-technical-indicators" class="nav-link" data-scroll-target="#market-data-technical-indicators">2. Market Data Technical Indicators</a></li>
  <li><a href="#personal-income-and-saving-data" id="toc-personal-income-and-saving-data" class="nav-link" data-scroll-target="#personal-income-and-saving-data">3. Personal Income and Saving Data</a></li>
  <li><a href="#government-spending-data" id="toc-government-spending-data" class="nav-link" data-scroll-target="#government-spending-data">4. Government Spending Data</a></li>
  </ul></li>
  <li><a href="#implementation-requirements" id="toc-implementation-requirements" class="nav-link" data-scroll-target="#implementation-requirements">Implementation Requirements</a>
  <ul class="collapse">
  <li><a href="#data-quality-standards" id="toc-data-quality-standards" class="nav-link" data-scroll-target="#data-quality-standards">Data Quality Standards</a></li>
  <li><a href="#code-organization" id="toc-code-organization" class="nav-link" data-scroll-target="#code-organization">Code Organization</a></li>
  </ul></li>
  <li><a href="#validation-and-quality-checks" id="toc-validation-and-quality-checks" class="nav-link" data-scroll-target="#validation-and-quality-checks">Validation and Quality Checks</a>
  <ul class="collapse">
  <li><a href="#required-checks" id="toc-required-checks" class="nav-link" data-scroll-target="#required-checks">Required Checks</a></li>
  </ul></li>
  <li><a href="#output-specifications" id="toc-output-specifications" class="nav-link" data-scroll-target="#output-specifications">Output Specifications</a>
  <ul class="collapse">
  <li><a href="#file-structure" id="toc-file-structure" class="nav-link" data-scroll-target="#file-structure">File Structure</a></li>
  <li><a href="#cleaned-data-requirements" id="toc-cleaned-data-requirements" class="nav-link" data-scroll-target="#cleaned-data-requirements">Cleaned Data Requirements</a></li>
  </ul></li>
  <li><a href="#iterative-process-notes" id="toc-iterative-process-notes" class="nav-link" data-scroll-target="#iterative-process-notes">Iterative Process Notes</a></li>
  </ul></li>
  <li><a href="#code" id="toc-code" class="nav-link" data-scroll-target="#code">Code</a>
  <ul class="collapse">
  <li><a href="#set-the-path-to-store-data" id="toc-set-the-path-to-store-data" class="nav-link" data-scroll-target="#set-the-path-to-store-data">Set the path to store data</a></li>
  <li><a href="#processing-and-cleaning-macroeconomic-data" id="toc-processing-and-cleaning-macroeconomic-data" class="nav-link" data-scroll-target="#processing-and-cleaning-macroeconomic-data">Processing and Cleaning Macroeconomic Data</a></li>
  <li><a href="#processing-personal-income-and-saving-data-from-bea-table-20100" id="toc-processing-personal-income-and-saving-data-from-bea-table-20100" class="nav-link" data-scroll-target="#processing-personal-income-and-saving-data-from-bea-table-20100">Processing Personal Income and Saving Data from BEA Table 20100</a></li>
  <li><a href="#processing-government-spending-data-from-bea-table-10105" id="toc-processing-government-spending-data-from-bea-table-10105" class="nav-link" data-scroll-target="#processing-government-spending-data-from-bea-table-10105">Processing Government Spending Data from BEA Table 10105</a></li>
  <li><a href="#processing-market-data-and-calculating-technical-indicators" id="toc-processing-market-data-and-calculating-technical-indicators" class="nav-link" data-scroll-target="#processing-market-data-and-calculating-technical-indicators">Processing Market Data and Calculating Technical Indicators</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Data Cleaning</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<!-- After digesting the instructions, you can delete this cell, these are assignment instructions and do not need to be included in your final submission.  -->
<section id="instructions" class="level1">
<h1>Instructions</h1>
<section id="introduction-and-motivation" class="level2">
<h2 class="anchored" data-anchor-id="introduction-and-motivation">Introduction and Motivation</h2>
<p>This document outlines the data cleaning process for a financial market analysis project. The goal is to convert raw financial and economic data into a clean, structured format suitable for analysis. The process includes processing market data, macroeconomic indicators, personal income statistics and government spending information.</p>
</section>
<section id="overview-of-methods" class="level2">
<h2 class="anchored" data-anchor-id="overview-of-methods">Overview of Methods</h2>
<p>The cleaning process involves several key steps and methods:</p>
<ol type="1">
<li><strong>Data Organization</strong>
<ul>
<li>Raw data is stored in <code>data/raw-data</code></li>
<li>Processed data is saved to <code>data/processed-data</code></li>
<li>Each dataset type has specific cleaning requirements</li>
</ul></li>
<li><strong>Key Processing Steps</strong>
<ul>
<li>Missing value imputation</li>
<li>Date standardization</li>
<li>Technical indicator calculation</li>
<li>Feature engineering</li>
<li>Data validation and quality checks</li>
</ul></li>
</ol>
</section>
<section id="data-types-and-processing-requirements" class="level2">
<h2 class="anchored" data-anchor-id="data-types-and-processing-requirements">Data Types and Processing Requirements</h2>
<section id="macroeconomic-data" class="level3">
<h3 class="anchored" data-anchor-id="macroeconomic-data">1. Macroeconomic Data</h3>
<ul>
<li><strong>Required Variables</strong>: GDP, CPI, Unemployment, FedFundsRate, M2, Umscent</li>
<li><strong>Processing Steps</strong>:
<ul>
<li>Fill missing values using annual means</li>
<li>Calculate YoY and MoM growth rates</li>
<li>Generate lag variables for key indicators</li>
<li>Filter data from year 2000 onwards</li>
</ul></li>
</ul>
</section>
<section id="market-data-technical-indicators" class="level3">
<h3 class="anchored" data-anchor-id="market-data-technical-indicators">2. Market Data Technical Indicators</h3>
<ul>
<li><strong>Required Calculations</strong>:
<ul>
<li>Moving averages (50-day, 200-day)</li>
<li>RSI (14-day period)</li>
<li>MACD (12-day, 26-day EMAs)</li>
<li>Volatility metrics</li>
<li>Volume indicators</li>
<li>Price momentum indicators</li>
</ul></li>
</ul>
</section>
<section id="personal-income-and-saving-data" class="level3">
<h3 class="anchored" data-anchor-id="personal-income-and-saving-data">3. Personal Income and Saving Data</h3>
<ul>
<li><strong>Key Metrics</strong>:
<ul>
<li>Personal income</li>
<li>Disposable income</li>
<li>Saving rate</li>
<li>Consumption expenditures</li>
<li>Personal taxes</li>
</ul></li>
</ul>
</section>
<section id="government-spending-data" class="level3">
<h3 class="anchored" data-anchor-id="government-spending-data">4. Government Spending Data</h3>
<ul>
<li><strong>Components</strong>:
<ul>
<li>Federal spending</li>
<li>State and local spending</li>
<li>Total government expenditures</li>
</ul></li>
</ul>
</section>
</section>
<section id="implementation-requirements" class="level2">
<h2 class="anchored" data-anchor-id="implementation-requirements">Implementation Requirements</h2>
<section id="data-quality-standards" class="level3">
<h3 class="anchored" data-anchor-id="data-quality-standards">Data Quality Standards</h3>
<ol type="1">
<li><strong>Missing Values</strong>
<ul>
<li>Use forward fill for price data</li>
<li>Apply annual means for economic indicators</li>
<li>Zero-fill for volume data</li>
<li>Default values for technical indicators (e.g., RSI = 50)</li>
</ul></li>
<li><strong>Date Range</strong>
<ul>
<li>Start date: 2000-11-01</li>
<li>End date: 2024-11-30</li>
<li>Daily frequency for market data</li>
<li>Monthly/quarterly frequency for economic data</li>
</ul></li>
<li><strong>Technical Requirements</strong>
<ul>
<li>Use pandas for data manipulation</li>
<li>Implement proper error handling</li>
<li>Include data validation checks</li>
<li>Document all cleaning steps</li>
</ul></li>
</ol>
</section>
<section id="code-organization" class="level3">
<h3 class="anchored" data-anchor-id="code-organization">Code Organization</h3>
<ol type="1">
<li><strong>Setup</strong>
<ul>
<li>Define output folders</li>
<li>Import required libraries</li>
<li>Set up error logging</li>
</ul></li>
<li><strong>Functions</strong>
<ul>
<li>Implement cleaning functions for each data type</li>
<li>Create technical indicator calculations</li>
<li>Build data validation checks</li>
</ul></li>
<li><strong>Output</strong>
<ul>
<li>Save cleaned data in CSV format</li>
<li>Generate processing logs</li>
<li>Include data quality reports</li>
</ul></li>
</ol>
</section>
</section>
<section id="validation-and-quality-checks" class="level2">
<h2 class="anchored" data-anchor-id="validation-and-quality-checks">Validation and Quality Checks</h2>
<section id="required-checks" class="level3">
<h3 class="anchored" data-anchor-id="required-checks">Required Checks</h3>
<ol type="1">
<li><strong>Data Completeness</strong>
<ul>
<li>Verify all required columns exist</li>
<li>Check date continuity</li>
<li>Validate data ranges</li>
</ul></li>
<li><strong>Data Consistency</strong>
<ul>
<li>Check for outliers</li>
<li>Verify calculations</li>
<li>Ensure proper data types</li>
</ul></li>
<li><strong>Technical Indicator Validation</strong>
<ul>
<li>Confirm indicator calculations</li>
<li>Verify lag variables</li>
<li>Validate moving averages</li>
</ul></li>
</ol>
</section>
</section>
<section id="output-specifications" class="level2">
<h2 class="anchored" data-anchor-id="output-specifications">Output Specifications</h2>
<section id="file-structure" class="level3">
<h3 class="anchored" data-anchor-id="file-structure">File Structure</h3>
<pre><code>data/
├── raw-data/
│   ├── macro_series_raw_collection.csv
│   ├── t20100_raw_data.csv
│   ├── t10105_raw_data.csv
│   └── [asset]_raw_a.csv
└── processed-data/
    ├── macro_series_cleaned.csv
    ├── personal_info_cleaned.csv
    ├── Government_Spending_Breakdown.csv
    └── [asset]_cleaned.csv</code></pre>
</section>
<section id="cleaned-data-requirements" class="level3">
<h3 class="anchored" data-anchor-id="cleaned-data-requirements">Cleaned Data Requirements</h3>
<ul>
<li>All dates in datetime format</li>
<li>No missing values</li>
<li>Proper column naming</li>
<li>Consistent data types</li>
<li>Technical indicators calculated</li>
<li>Target variables generated</li>
</ul>
</section>
</section>
<section id="iterative-process-notes" class="level2">
<h2 class="anchored" data-anchor-id="iterative-process-notes">Iterative Process Notes</h2>
<p>The cleaning process may need to be revisited as:</p>
<ol type="1">
<li>New data becomes available</li>
<li>Analysis requirements change</li>
<li>Data quality issues are discovered</li>
<li>New features are needed</li>
</ol>
</section>
</section>
<section id="code" class="level1">
<h1>Code</h1>
<p>Provide the source code used for this section of the project here.</p>
<p>If you’re using a package for code organization, you can import it at this point. However, make sure that the <strong>actual workflow steps</strong>—including data processing, analysis, and other key tasks—are conducted and clearly demonstrated on this page. The goal is to show the technical flow of your project, highlighting how the code is executed to achieve your results.</p>
<p>If relevant, link to additional documentation or external references that explain any complex components. This section should give readers a clear view of how the project is implemented from a technical perspective.</p>
<p>Remember, this page is a technical narrative, NOT just a notebook with a collection of code cells, include in-line Prose, to describe what is going on.</p>
<section id="set-the-path-to-store-data" class="level2">
<h2 class="anchored" data-anchor-id="set-the-path-to-store-data">Set the path to store data</h2>
<div id="cell-4" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os  <span class="co"># Import os module for handling file paths</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the target folder for saving CSV files</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>output_folder_cleaned <span class="op">=</span> <span class="st">"../../data/processed-data"</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>raw_data_folder <span class="op">=</span> <span class="st">"../../data/raw-data"</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the folder if it doesn't exist</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> os.path.exists(output_folder_cleaned):</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    os.makedirs(output_folder_cleaned)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="processing-and-cleaning-macroeconomic-data" class="level2">
<h2 class="anchored" data-anchor-id="processing-and-cleaning-macroeconomic-data">Processing and Cleaning Macroeconomic Data</h2>
<div id="cell-6" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the raw data file</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>raw_data_file <span class="op">=</span> os.path.join(raw_data_folder, <span class="st">"macro_series_raw_collection.csv"</span>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Read the CSV file</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    merged_data <span class="op">=</span> pd.read_csv(raw_data_file)</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    merged_data[<span class="st">"date"</span>] <span class="op">=</span> pd.to_datetime(merged_data[<span class="st">"date"</span>])  <span class="co"># Ensure the date column is in datetime format</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">FileNotFoundError</span>:</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Error: File '</span><span class="sc">{</span>raw_data_file<span class="sc">}</span><span class="ss">' not found."</span>)</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    exit()</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Error loading file: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    exit()</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the year as a new column</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>merged_data[<span class="st">"year"</span>] <span class="op">=</span> merged_data[<span class="st">"date"</span>].dt.year</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if the required columns exist</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>required_columns <span class="op">=</span> [<span class="st">"GDP"</span>, <span class="st">"Umscent"</span>, <span class="st">"Exports"</span>, <span class="st">"Imports"</span>, <span class="st">"CPI"</span>]</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>missing_columns <span class="op">=</span> [col <span class="cf">for</span> col <span class="kw">in</span> required_columns <span class="cf">if</span> col <span class="kw">not</span> <span class="kw">in</span> merged_data.columns]</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> missing_columns:</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Error: Missing required columns: </span><span class="sc">{</span>missing_columns<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>    exit()</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a><span class="co"># ======= Define Function =======</span></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> fill_missing_with_annual_mean(data, column):</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a><span class="co">    Fill missing values: Calculate the annual mean for each year and use it to fill missing values.</span></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>    annual_mean <span class="op">=</span> data.groupby(<span class="st">"year"</span>)[column].transform(<span class="st">"mean"</span>)</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>    data[column] <span class="op">=</span> data[column].fillna(annual_mean)</span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a><span class="co"># ======= Fill Missing Values =======</span></span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>fill_missing_with_annual_mean(merged_data, <span class="st">"GDP"</span>)</span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>fill_missing_with_annual_mean(merged_data, <span class="st">"Umscent"</span>)</span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>fill_missing_with_annual_mean(merged_data, <span class="st">"Exports"</span>)</span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>fill_missing_with_annual_mean(merged_data, <span class="st">"Imports"</span>)</span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a><span class="co"># ======= Calculate Growth Rates =======</span></span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate Year-over-Year (YoY) and Month-over-Month (MoM) growth rates for GDP</span></span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>merged_data[<span class="st">"GDP_YoY"</span>] <span class="op">=</span> merged_data[<span class="st">"GDP"</span>].pct_change(periods<span class="op">=</span><span class="dv">12</span>)  <span class="co"># YoY GDP growth</span></span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a>merged_data[<span class="st">"GDP_MoM"</span>] <span class="op">=</span> merged_data[<span class="st">"GDP"</span>].pct_change(periods<span class="op">=</span><span class="dv">1</span>)   <span class="co"># MoM GDP growth</span></span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the YoY growth rate for CPI</span></span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a>merged_data[<span class="st">"CPI_YoY"</span>] <span class="op">=</span> merged_data[<span class="st">"CPI"</span>].pct_change(periods<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a><span class="co"># ======= Add Lag Variables =======</span></span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a>merged_data[<span class="st">"GDP_Lag1"</span>] <span class="op">=</span> merged_data[<span class="st">"GDP"</span>].shift(<span class="dv">1</span>)  <span class="co"># Previous month's GDP</span></span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a>merged_data[<span class="st">"CPI_Lag1"</span>] <span class="op">=</span> merged_data[<span class="st">"CPI"</span>].shift(<span class="dv">1</span>)  <span class="co"># Previous month's CPI</span></span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a><span class="co"># ======= Filter Data =======</span></span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter the data: Keep only data from the year 2000 and later</span></span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a>filtered_data <span class="op">=</span> merged_data[merged_data[<span class="st">"year"</span>] <span class="op">&gt;=</span> <span class="dv">2000</span>]</span>
<span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a><span class="co"># ======= Save Cleaned Data =======</span></span>
<span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a>output_file <span class="op">=</span> os.path.join(output_folder_cleaned, <span class="st">"macro_series_cleaned.csv"</span>)</span>
<span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a>filtered_data.to_csv(output_file, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb3-66"><a href="#cb3-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-67"><a href="#cb3-67" aria-hidden="true" tabindex="-1"></a><span class="co"># ======= Print Data Summary =======</span></span>
<span id="cb3-68"><a href="#cb3-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-69"><a href="#cb3-69" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Cleaned data saved to '</span><span class="sc">{</span>output_file<span class="sc">}</span><span class="ss">'."</span>)</span>
<span id="cb3-70"><a href="#cb3-70" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(filtered_data.head(<span class="dv">20</span>))</span>
<span id="cb3-71"><a href="#cb3-71" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(filtered_data.info())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Cleaned data saved to '/Users/qqmian/Desktop/GU_5000/Stock_Market_Performance/data/processed-data/macro_series_cleaned.csv'.
          date        GDP    CPI  Unemployment  FedFundsRate      M2  Umscent  \
640 2000-01-01  10002.179  169.3           4.0          5.45  4667.6    112.0   
641 2000-02-01  10250.952  170.0           4.1          5.73  4680.9    111.3   
642 2000-03-01  10250.952  171.0           4.0          5.85  4711.7    107.1   
643 2000-04-01  10247.720  170.9           3.8          6.02  4767.8    109.2   
644 2000-05-01  10250.952  171.2           4.0          6.27  4755.7    110.7   
645 2000-06-01  10250.952  172.2           4.0          6.53  4773.6    106.4   
646 2000-07-01  10318.165  172.7           4.0          6.54  4791.3    108.3   
647 2000-08-01  10250.952  172.7           4.1          6.50  4819.5    107.3   
648 2000-09-01  10250.952  173.6           3.9          6.52  4855.3    106.8   
649 2000-10-01  10435.744  173.9           3.9          6.51  4871.4    105.8   
650 2000-11-01  10250.952  174.2           3.9          6.51  4882.8    107.6   
651 2000-12-01  10250.952  174.6           3.9          6.40  4927.7     98.4   
652 2001-01-01  10470.231  175.6           4.2          5.98  4978.4     94.7   
653 2001-02-01  10581.929  176.0           4.2          5.49  5017.1     90.6   
654 2001-03-01  10581.929  176.1           4.3          5.31  5074.9     91.5   
655 2001-04-01  10599.000  176.4           4.4          4.80  5139.2     88.4   
656 2001-05-01  10581.929  177.3           4.3          4.21  5137.3     92.0   
657 2001-06-01  10581.929  177.7           4.5          3.97  5180.3     92.6   
658 2001-07-01  10598.020  177.4           4.6          3.77  5210.2     92.4   
659 2001-08-01  10581.929  177.4           4.9          3.65  5243.9     91.5   

     real_estate     Exports   Imports  year   GDP_YoY   GDP_MoM   CPI_YoY  \
640      100.000  1052.90400  1409.487  2000  0.062741  0.038522  0.027930   
641      100.571  1096.11075  1477.184  2000  0.064351  0.024872  0.032180   
642      101.466  1096.11075  1477.184  2000  0.064351  0.000000  0.037621   
643      102.541  1093.36000  1455.860  2000  0.075739 -0.000315  0.030139   
644      103.702  1096.11075  1477.184  2000  0.064351  0.000315  0.031325   
645      104.856  1096.11075  1477.184  2000  0.064351  0.000000  0.037349   
646      105.722  1125.00200  1518.869  2000  0.065197  0.006557  0.035993   
647      106.522  1096.11075  1477.184  2000  0.064351 -0.006514  0.033513   
648      107.136  1096.11075  1477.184  2000  0.064351  0.000000  0.034565   
649      107.729  1113.17700  1524.520  2000  0.054098  0.018027  0.034503   
650      108.292  1096.11075  1477.184  2000  0.064351 -0.017708  0.034442   
651      108.792  1096.11075  1477.184  2000  0.064351  0.000000  0.034360   
652      109.215  1096.81200  1499.464  2001  0.046795  0.021391  0.037212   
653      109.643  1026.81175  1403.559  2001  0.032287  0.010668  0.035294   
654      110.395  1026.81175  1403.559  2001  0.032287  0.000000  0.029825   
655      111.248  1058.01300  1422.028  2001  0.034279  0.001613  0.032183   
656      112.203  1026.81175  1403.559  2001  0.032287 -0.001611  0.035631   
657      113.273  1026.81175  1403.559  2001  0.032287  0.000000  0.031940   
658      114.227   998.90200  1369.536  2001  0.027123  0.001521  0.027215   
659      114.989  1026.81175  1403.559  2001  0.032287 -0.001518  0.027215   

        GDP_Lag1  CPI_Lag1  
640   9631.17175     168.8  
641  10002.17900     169.3  
642  10250.95200     170.0  
643  10250.95200     171.0  
644  10247.72000     170.9  
645  10250.95200     171.2  
646  10250.95200     172.2  
647  10318.16500     172.7  
648  10250.95200     172.7  
649  10250.95200     173.6  
650  10435.74400     173.9  
651  10250.95200     174.2  
652  10250.95200     174.6  
653  10470.23100     175.6  
654  10581.92900     176.0  
655  10581.92900     176.1  
656  10599.00000     176.4  
657  10581.92900     177.3  
658  10581.92900     177.7  
659  10598.02000     177.4  
&lt;class 'pandas.core.frame.DataFrame'&gt;
Index: 299 entries, 640 to 938
Data columns (total 16 columns):
 #   Column        Non-Null Count  Dtype         
---  ------        --------------  -----         
 0   date          299 non-null    datetime64[ns]
 1   GDP           299 non-null    float64       
 2   CPI           299 non-null    float64       
 3   Unemployment  299 non-null    float64       
 4   FedFundsRate  299 non-null    float64       
 5   M2            298 non-null    float64       
 6   Umscent       299 non-null    float64       
 7   real_estate   297 non-null    float64       
 8   Exports       299 non-null    float64       
 9   Imports       299 non-null    float64       
 10  year          299 non-null    int32         
 11  GDP_YoY       299 non-null    float64       
 12  GDP_MoM       299 non-null    float64       
 13  CPI_YoY       299 non-null    float64       
 14  GDP_Lag1      299 non-null    float64       
 15  CPI_Lag1      299 non-null    float64       
dtypes: datetime64[ns](1), float64(14), int32(1)
memory usage: 38.5 KB
None</code></pre>
</div>
</div>
</section>
<section id="processing-personal-income-and-saving-data-from-bea-table-20100" class="level2">
<h2 class="anchored" data-anchor-id="processing-personal-income-and-saving-data-from-bea-table-20100">Processing Personal Income and Saving Data from BEA Table 20100</h2>
<div id="cell-8" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>raw_data_file <span class="op">=</span> os.path.join(raw_data_folder, <span class="st">"t20100_raw_data.csv"</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>t20100_data <span class="op">=</span> pd.read_csv(raw_data_file)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter key data</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> clean_t20100_data(df):</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Define the keywords for the fields we need</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    keywords <span class="op">=</span> [</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Personal income"</span>,</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Equals: Disposable personal income"</span>,</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Equals: Personal saving"</span>,</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Personal saving as a percentage of disposable personal income"</span>,</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Personal consumption expenditures"</span>,</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Less: Personal current taxes"</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter the data we need</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    filtered_df <span class="op">=</span> df[df[<span class="st">"LineDescription"</span>].<span class="bu">str</span>.contains(<span class="st">"|"</span>.join(keywords), case<span class="op">=</span><span class="va">False</span>, na<span class="op">=</span><span class="va">False</span>)]</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Keep only the required fields</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    filtered_df <span class="op">=</span> filtered_df[[<span class="st">"TimePeriod"</span>, <span class="st">"LineDescription"</span>, <span class="st">"DataValue"</span>]]</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert DataValue to numeric type</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>    filtered_df[<span class="st">"DataValue"</span>] <span class="op">=</span> filtered_df[<span class="st">"DataValue"</span>].astype(<span class="bu">str</span>)  <span class="co"># Ensure it's a string</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>    filtered_df[<span class="st">"DataValue"</span>] <span class="op">=</span> filtered_df[<span class="st">"DataValue"</span>].<span class="bu">str</span>.replace(<span class="st">","</span>, <span class="st">""</span>, regex<span class="op">=</span><span class="va">True</span>).<span class="bu">str</span>.strip()  <span class="co"># Remove commas and spaces</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert DataValue to numeric type</span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>    filtered_df[<span class="st">"DataValue"</span>] <span class="op">=</span> pd.to_numeric(filtered_df[<span class="st">"DataValue"</span>], errors<span class="op">=</span><span class="st">"coerce"</span>)</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> filtered_df</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>filtered_t20100 <span class="op">=</span> clean_t20100_data(t20100_data)</span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the filtered data</span></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Filtered T20100 data:"</span>)</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(filtered_t20100.head())</span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Pivot the data to wide format</span></span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>t20100_wide <span class="op">=</span> filtered_t20100.pivot(index<span class="op">=</span><span class="st">"TimePeriod"</span>, columns<span class="op">=</span><span class="st">"LineDescription"</span>, values<span class="op">=</span><span class="st">"DataValue"</span>).reset_index()</span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename columns (for easier merging later)</span></span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>t20100_wide.rename(columns<span class="op">=</span>{</span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Personal income"</span>: <span class="st">"Personal_Income (Millions of $)"</span>,</span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Equals: Disposable personal income"</span>: <span class="st">"Disposable_Income (Millions of $)"</span>,</span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Equals: Personal saving"</span>: <span class="st">"Personal_Saving (Millions of $)"</span>,</span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Personal saving as a percentage of disposable personal income"</span>: <span class="st">"Saving_Rate (%)"</span>,</span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Personal consumption expenditures"</span>: <span class="st">"Consumption_Expenditures (Millions of $)"</span>,</span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Less: Personal current taxes"</span>: <span class="st">"Personal_Taxes (Millions of $)"</span></span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>}, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the reshaped data</span></span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Reshaped T20100 data:"</span>)</span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(t20100_wide.tail())</span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a>filtered_data <span class="op">=</span> t20100_wide[t20100_wide[<span class="st">"TimePeriod"</span>] <span class="op">&gt;=</span> <span class="dv">2000</span>]</span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a>file_name <span class="op">=</span> os.path.join(output_folder_cleaned, <span class="ss">f"personal_info_cleaned.csv"</span>)</span>
<span id="cb5-58"><a href="#cb5-58" aria-hidden="true" tabindex="-1"></a>filtered_data.to_csv(file_name, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb5-59"><a href="#cb5-59" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Data for personal_info_cleaned saved to '</span><span class="sc">{</span>file_name<span class="sc">}</span><span class="ss">'."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Filtered T20100 data:
   TimePeriod  LineDescription  DataValue
0        1929  Personal income    85289.0
1        1930  Personal income    76533.0
2        1931  Personal income    65668.0
3        1932  Personal income    50294.0
4        1933  Personal income    47234.0
Reshaped T20100 data:
LineDescription  TimePeriod  \
90                     2019   
91                     2020   
92                     2021   
93                     2022   
94                     2023   

LineDescription  Disposable personal income, chained (2017) dollars  \
90                                                             3.1    
91                                                             6.3    
92                                                             3.4    
93                                                            -5.5    
94                                                             5.1    

LineDescription  Disposable personal income, current dollars  \
90                                                       4.6   
91                                                       7.5   
92                                                       7.7   
93                                                       0.7   
94                                                       9.0   

LineDescription  Disposable_Income (Millions of $)  \
90                                      16164498.0   
91                                      17374805.0   
92                                      18714400.0   
93                                      18844013.0   
94                                      20546800.0   

LineDescription  Personal_Saving (Millions of $)  \
90                                     1178158.0   
91                                     2659010.0   
92                                     2095700.0   
93                                      566096.0   
94                                      967225.0   

LineDescription  Personal_Taxes (Millions of $)  \
90                                    2198663.0   
91                                    2245277.0   
92                                    2705098.0   
93                                    3244907.0   
94                                    2855735.0   

LineDescription  Consumption_Expenditures (Millions of $)  \
90                                             14437543.0   
91                                             14225657.0   
92                                             16113945.0   
93                                             17690841.0   
94                                             18822769.0   

LineDescription  Personal_Income (Millions of $)  \
90                                    18363160.0   
91                                    19620082.0   
92                                    21419498.0   
93                                    22088920.0   
94                                    23402535.0   

LineDescription  Personal income excluding current transfer receipts, Billions of chained (2017) dollars  \
90                                                      14700259.0                                         
91                                                      14708618.0                                         
92                                                      15385380.0                                         
93                                                      15459172.0                                         
94                                                      15880418.0                                         

LineDescription  Personal income receipts on assets  Saving_Rate (%)  
90                                        2950022.0              7.3  
91                                        2912422.0             15.3  
92                                        3180726.0             11.2  
93                                        3474032.0              3.0  
94                                        3822888.0              4.7  
Data for personal_info_cleaned saved to '/Users/qqmian/Desktop/GU_5000/Stock_Market_Performance/data/processed-data/personal_info_cleaned.csv'.</code></pre>
</div>
</div>
</section>
<section id="processing-government-spending-data-from-bea-table-10105" class="level2">
<h2 class="anchored" data-anchor-id="processing-government-spending-data-from-bea-table-10105">Processing Government Spending Data from BEA Table 10105</h2>
<div id="cell-10" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>raw_data_file <span class="op">=</span> os.path.join(raw_data_folder, <span class="st">"t10105_raw_data.csv"</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>t10105_data <span class="op">=</span> pd.read_csv(raw_data_file)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> clean_t10105_data(df):</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Define the keywords for the required fields</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    keywords <span class="op">=</span> [</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>       <span class="st">"Government consumption expenditures and gross investment"</span>,</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>       <span class="st">"Federal"</span>,</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>       <span class="st">"State and local"</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter the required data</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    filtered_df <span class="op">=</span> df[df[<span class="st">"LineDescription"</span>].<span class="bu">str</span>.contains(<span class="st">"|"</span>.join(keywords), case<span class="op">=</span><span class="va">False</span>, na<span class="op">=</span><span class="va">False</span>)]</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Keep only the required columns</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    filtered_df <span class="op">=</span> filtered_df[[<span class="st">"TimePeriod"</span>, <span class="st">"LineDescription"</span>, <span class="st">"DataValue"</span>]]</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Remove commas from the DataValue column (to prepare for numeric conversion)</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>    filtered_df[<span class="st">"DataValue"</span>] <span class="op">=</span> filtered_df[<span class="st">"DataValue"</span>].<span class="bu">str</span>.replace(<span class="st">","</span>, <span class="st">""</span>, regex<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert the cleaned DataValue column to numeric type</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>    filtered_df[<span class="st">"DataValue"</span>] <span class="op">=</span> pd.to_numeric(filtered_df[<span class="st">"DataValue"</span>], errors<span class="op">=</span><span class="st">"coerce"</span>)</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> filtered_df</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Fetch T10105 data</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>filtered_t10105 <span class="op">=</span> clean_t10105_data(t10105_data)</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the filtered data</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Filtered T10105 data:"</span>)</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(filtered_t10105.head())</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Reshape the data to wide format</span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>t10105_wide <span class="op">=</span> filtered_t10105.pivot(index<span class="op">=</span><span class="st">"TimePeriod"</span>, columns<span class="op">=</span><span class="st">"LineDescription"</span>, values<span class="op">=</span><span class="st">"DataValue"</span>).reset_index()</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename columns (for easier merging or analysis)</span></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>t10105_wide.rename(columns<span class="op">=</span>{</span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Government consumption expenditures and gross investment"</span>: <span class="st">"Government consumption expenditures and gross investment"</span>,</span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>}, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the data to billions of dollars by dividing by 1000</span></span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Add "(Millions of $)" to column names for better clarity</span></span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>t10105_wide.rename(columns<span class="op">=</span><span class="kw">lambda</span> x: <span class="ss">f"</span><span class="sc">{</span>x<span class="sc">}</span><span class="ss"> (Millions of $)"</span> <span class="cf">if</span> x <span class="op">!=</span> <span class="st">"TimePeriod"</span> <span class="cf">else</span> x, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the reshaped data</span></span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Reshaped T10105 data:"</span>)</span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(t10105_wide.tail())</span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the data as a CSV file</span></span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a>file_name <span class="op">=</span> os.path.join(output_folder_cleaned, <span class="ss">f"Government_Spending_Breakdown.csv"</span>)</span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a>t10105_wide.to_csv(file_name, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Data for Government_Spending_Breakdown saved to '</span><span class="sc">{</span>file_name<span class="sc">}</span><span class="ss">'."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Filtered T10105 data:
      TimePeriod                                    LineDescription  DataValue
1995        1929  Government consumption expenditures and gross ...       9622
1996        1930  Government consumption expenditures and gross ...      10273
1997        1931  Government consumption expenditures and gross ...      10169
1998        1932  Government consumption expenditures and gross ...       8946
1999        1933  Government consumption expenditures and gross ...       8875
Reshaped T10105 data:
LineDescription  TimePeriod  Federal (Millions of $)  \
90                     2019                  1419500   
91                     2020                  1523016   
92                     2021                  1603184   
93                     2022                  1641036   
94                     2023                  1762627   

LineDescription  Government consumption expenditures and gross investment (Millions of $)  \
90                                                         3785995                          
91                                                         3999638                          
92                                                         4203482                          
93                                                         4453765                          
94                                                         4710522                          

LineDescription  State and local (Millions of $)  
90                                       2366496  
91                                       2476621  
92                                       2600299  
93                                       2812730  
94                                       2947896  
Data for Government_Spending_Breakdown saved to '/Users/qqmian/Desktop/GU_5000/Stock_Market_Performance/data/processed-data/Government_Spending_Breakdown.csv'.</code></pre>
</div>
</div>
</section>
<section id="processing-market-data-and-calculating-technical-indicators" class="level2">
<h2 class="anchored" data-anchor-id="processing-market-data-and-calculating-technical-indicators">Processing Market Data and Calculating Technical Indicators</h2>
<div id="cell-12" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculate_rsi(data, window<span class="op">=</span><span class="dv">14</span>):</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co">    Calculate RSI (Relative Strength Index) indicator.</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    delta <span class="op">=</span> data[<span class="st">'Close'</span>].diff(<span class="dv">1</span>)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    gain <span class="op">=</span> (delta.where(delta <span class="op">&gt;</span> <span class="dv">0</span>, <span class="dv">0</span>)).rolling(window<span class="op">=</span>window).mean()</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    loss <span class="op">=</span> (<span class="op">-</span>delta.where(delta <span class="op">&lt;</span> <span class="dv">0</span>, <span class="dv">0</span>)).rolling(window<span class="op">=</span>window).mean()</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    rs <span class="op">=</span> gain <span class="op">/</span> loss</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    rsi <span class="op">=</span> <span class="dv">100</span> <span class="op">-</span> (<span class="dv">100</span> <span class="op">/</span> (<span class="dv">1</span> <span class="op">+</span> rs))</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> rsi</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> clean_and_process_data(data, date_range):</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="co">    Cleans and processes raw financial data, including calculating technical indicators,</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="co">    filling missing values, and generating target variables.</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Ensure the 'Date' column is in datetime format and set it as the index</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>        data[<span class="st">"Date"</span>] <span class="op">=</span> pd.to_datetime(data[<span class="st">"Date"</span>])</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>        data <span class="op">=</span> data.set_index(<span class="st">"Date"</span>)</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>        <span class="co"># === Calculate technical indicators ===</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>        data[<span class="st">"MA_50"</span>] <span class="op">=</span> data[<span class="st">"Close"</span>].rolling(window<span class="op">=</span><span class="dv">50</span>).mean()  <span class="co"># 50-day moving average</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>        data[<span class="st">"MA_200"</span>] <span class="op">=</span> data[<span class="st">"Close"</span>].rolling(window<span class="op">=</span><span class="dv">200</span>).mean()  <span class="co"># 200-day moving average</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>        data[<span class="st">"Daily_Return"</span>] <span class="op">=</span> data[<span class="st">"Close"</span>].pct_change()  <span class="co"># Daily return</span></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>        data[<span class="st">"Volatility"</span>] <span class="op">=</span> data[<span class="st">"Daily_Return"</span>].rolling(window<span class="op">=</span><span class="dv">30</span>).std()  <span class="co"># 30-day volatility</span></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>        data[<span class="st">"RSI"</span>] <span class="op">=</span> calculate_rsi(data, window<span class="op">=</span><span class="dv">14</span>)  <span class="co"># RSI indicator</span></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>        data[<span class="st">"EMA_12"</span>] <span class="op">=</span> data[<span class="st">"Close"</span>].ewm(span<span class="op">=</span><span class="dv">12</span>, adjust<span class="op">=</span><span class="va">False</span>).mean()  <span class="co"># 12-day EMA</span></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>        data[<span class="st">"EMA_26"</span>] <span class="op">=</span> data[<span class="st">"Close"</span>].ewm(span<span class="op">=</span><span class="dv">26</span>, adjust<span class="op">=</span><span class="va">False</span>).mean()  <span class="co"># 26-day EMA</span></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>        data[<span class="st">"MACD"</span>] <span class="op">=</span> data[<span class="st">"EMA_12"</span>] <span class="op">-</span> data[<span class="st">"EMA_26"</span>]  <span class="co"># MACD line</span></span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>        data[<span class="st">"Signal_Line"</span>] <span class="op">=</span> data[<span class="st">"MACD"</span>].ewm(span<span class="op">=</span><span class="dv">9</span>, adjust<span class="op">=</span><span class="va">False</span>).mean()  <span class="co"># Signal line</span></span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>        data[<span class="st">"High_Low"</span>] <span class="op">=</span> data[<span class="st">"High"</span>] <span class="op">-</span> data[<span class="st">"Low"</span>]  <span class="co"># High-Low range</span></span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>        data[<span class="st">"High_Close"</span>] <span class="op">=</span> <span class="bu">abs</span>(data[<span class="st">"High"</span>] <span class="op">-</span> data[<span class="st">"Close"</span>].shift(<span class="dv">1</span>))  <span class="co"># High-Close range</span></span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>        data[<span class="st">"Low_Close"</span>] <span class="op">=</span> <span class="bu">abs</span>(data[<span class="st">"Low"</span>] <span class="op">-</span> data[<span class="st">"Close"</span>].shift(<span class="dv">1</span>))  <span class="co"># Low-Close range</span></span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>        data[<span class="st">"True_Range"</span>] <span class="op">=</span> data[[<span class="st">"High_Low"</span>, <span class="st">"High_Close"</span>, <span class="st">"Low_Close"</span>]].<span class="bu">max</span>(axis<span class="op">=</span><span class="dv">1</span>)  <span class="co"># True Range</span></span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>        data[<span class="st">"ATR"</span>] <span class="op">=</span> data[<span class="st">"True_Range"</span>].rolling(window<span class="op">=</span><span class="dv">14</span>).mean()  <span class="co"># Average True Range (ATR)</span></span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>        data[<span class="st">"OBV"</span>] <span class="op">=</span> (np.sign(data[<span class="st">"Close"</span>].diff()) <span class="op">*</span> data[<span class="st">"Volume"</span>]).fillna(<span class="dv">0</span>).cumsum()  <span class="co"># On-Balance Volume (OBV)</span></span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Add lagged technical indicators</span></span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> lag <span class="kw">in</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>]:</span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a>            data[<span class="ss">f"RSI_Lag</span><span class="sc">{</span>lag<span class="sc">}</span><span class="ss">"</span>] <span class="op">=</span> data[<span class="st">"RSI"</span>].shift(lag)</span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a>            data[<span class="ss">f"MACD_Lag</span><span class="sc">{</span>lag<span class="sc">}</span><span class="ss">"</span>] <span class="op">=</span> data[<span class="st">"MACD"</span>].shift(lag)</span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a>            data[<span class="ss">f"Close_Lag</span><span class="sc">{</span>lag<span class="sc">}</span><span class="ss">"</span>] <span class="op">=</span> data[<span class="st">"Close"</span>].shift(lag)</span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a>            data[<span class="ss">f"Volume_Lag</span><span class="sc">{</span>lag<span class="sc">}</span><span class="ss">"</span>] <span class="op">=</span> data[<span class="st">"Volume"</span>].shift(lag)</span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a>        <span class="co"># === Align data with the specified date range ===</span></span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a>        data <span class="op">=</span> data.reindex(date_range)</span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a>        <span class="co"># === Drop rows with insufficient data for technical indicators ===</span></span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Drop rows where MA_200 or other long-window indicators are NaN</span></span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a>        data.dropna(subset<span class="op">=</span>[<span class="st">"MA_200"</span>, <span class="st">"EMA_12"</span>, <span class="st">"EMA_26"</span>], inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a>        <span class="co"># === Fill missing values ===</span></span>
<span id="cb9-55"><a href="#cb9-55" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Fill price data</span></span>
<span id="cb9-56"><a href="#cb9-56" aria-hidden="true" tabindex="-1"></a>        data[<span class="st">"Close"</span>] <span class="op">=</span> data[<span class="st">"Close"</span>].fillna(method<span class="op">=</span><span class="st">"ffill"</span>).fillna(method<span class="op">=</span><span class="st">"bfill"</span>)</span>
<span id="cb9-57"><a href="#cb9-57" aria-hidden="true" tabindex="-1"></a>        data[<span class="st">"Open"</span>] <span class="op">=</span> data[<span class="st">"Open"</span>].fillna(method<span class="op">=</span><span class="st">"ffill"</span>).fillna(method<span class="op">=</span><span class="st">"bfill"</span>)</span>
<span id="cb9-58"><a href="#cb9-58" aria-hidden="true" tabindex="-1"></a>        data[<span class="st">"High"</span>] <span class="op">=</span> data[<span class="st">"High"</span>].fillna(method<span class="op">=</span><span class="st">"ffill"</span>).fillna(method<span class="op">=</span><span class="st">"bfill"</span>)</span>
<span id="cb9-59"><a href="#cb9-59" aria-hidden="true" tabindex="-1"></a>        data[<span class="st">"Low"</span>] <span class="op">=</span> data[<span class="st">"Low"</span>].fillna(method<span class="op">=</span><span class="st">"ffill"</span>).fillna(method<span class="op">=</span><span class="st">"bfill"</span>)</span>
<span id="cb9-60"><a href="#cb9-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-61"><a href="#cb9-61" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Fill volume data</span></span>
<span id="cb9-62"><a href="#cb9-62" aria-hidden="true" tabindex="-1"></a>        data[<span class="st">"Volume"</span>] <span class="op">=</span> data[<span class="st">"Volume"</span>].fillna(<span class="dv">0</span>)</span>
<span id="cb9-63"><a href="#cb9-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-64"><a href="#cb9-64" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Fill technical indicators</span></span>
<span id="cb9-65"><a href="#cb9-65" aria-hidden="true" tabindex="-1"></a>        data[<span class="st">"MA_50"</span>] <span class="op">=</span> data[<span class="st">"MA_50"</span>].fillna(method<span class="op">=</span><span class="st">"ffill"</span>)</span>
<span id="cb9-66"><a href="#cb9-66" aria-hidden="true" tabindex="-1"></a>        data[<span class="st">"MA_200"</span>] <span class="op">=</span> data[<span class="st">"MA_200"</span>].fillna(method<span class="op">=</span><span class="st">"ffill"</span>)</span>
<span id="cb9-67"><a href="#cb9-67" aria-hidden="true" tabindex="-1"></a>        data[<span class="st">"Daily_Return"</span>] <span class="op">=</span> data[<span class="st">"Daily_Return"</span>].fillna(<span class="dv">0</span>)  <span class="co"># Default daily return to 0</span></span>
<span id="cb9-68"><a href="#cb9-68" aria-hidden="true" tabindex="-1"></a>        data[<span class="st">"Volatility"</span>] <span class="op">=</span> data[<span class="st">"Volatility"</span>].fillna(<span class="dv">0</span>)  <span class="co"># Default volatility to 0</span></span>
<span id="cb9-69"><a href="#cb9-69" aria-hidden="true" tabindex="-1"></a>        data[<span class="st">"RSI"</span>] <span class="op">=</span> data[<span class="st">"RSI"</span>].fillna(<span class="dv">50</span>)  <span class="co"># Default RSI to neutral value of 50</span></span>
<span id="cb9-70"><a href="#cb9-70" aria-hidden="true" tabindex="-1"></a>        data[<span class="st">"MACD"</span>] <span class="op">=</span> data[<span class="st">"MACD"</span>].fillna(<span class="dv">0</span>)</span>
<span id="cb9-71"><a href="#cb9-71" aria-hidden="true" tabindex="-1"></a>        data[<span class="st">"Signal_Line"</span>] <span class="op">=</span> data[<span class="st">"Signal_Line"</span>].fillna(<span class="dv">0</span>)</span>
<span id="cb9-72"><a href="#cb9-72" aria-hidden="true" tabindex="-1"></a>        data[<span class="st">"ATR"</span>] <span class="op">=</span> data[<span class="st">"ATR"</span>].fillna(<span class="dv">0</span>)</span>
<span id="cb9-73"><a href="#cb9-73" aria-hidden="true" tabindex="-1"></a>        data[<span class="st">"High_Low"</span>] <span class="op">=</span> data[<span class="st">"High_Low"</span>].fillna(<span class="dv">0</span>)</span>
<span id="cb9-74"><a href="#cb9-74" aria-hidden="true" tabindex="-1"></a>        data[<span class="st">"High_Close"</span>] <span class="op">=</span> data[<span class="st">"High_Close"</span>].fillna(<span class="dv">0</span>)</span>
<span id="cb9-75"><a href="#cb9-75" aria-hidden="true" tabindex="-1"></a>        data[<span class="st">"Low_Close"</span>] <span class="op">=</span> data[<span class="st">"Low_Close"</span>].fillna(<span class="dv">0</span>)</span>
<span id="cb9-76"><a href="#cb9-76" aria-hidden="true" tabindex="-1"></a>        data[<span class="st">"True_Range"</span>] <span class="op">=</span> data[<span class="st">"True_Range"</span>].fillna(<span class="dv">0</span>)</span>
<span id="cb9-77"><a href="#cb9-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-78"><a href="#cb9-78" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Fill lagged indicators</span></span>
<span id="cb9-79"><a href="#cb9-79" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> lag <span class="kw">in</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>]:</span>
<span id="cb9-80"><a href="#cb9-80" aria-hidden="true" tabindex="-1"></a>            data[<span class="ss">f"RSI_Lag</span><span class="sc">{</span>lag<span class="sc">}</span><span class="ss">"</span>] <span class="op">=</span> data[<span class="ss">f"RSI_Lag</span><span class="sc">{</span>lag<span class="sc">}</span><span class="ss">"</span>].fillna(<span class="dv">50</span>)</span>
<span id="cb9-81"><a href="#cb9-81" aria-hidden="true" tabindex="-1"></a>            data[<span class="ss">f"MACD_Lag</span><span class="sc">{</span>lag<span class="sc">}</span><span class="ss">"</span>] <span class="op">=</span> data[<span class="ss">f"MACD_Lag</span><span class="sc">{</span>lag<span class="sc">}</span><span class="ss">"</span>].fillna(<span class="dv">0</span>)</span>
<span id="cb9-82"><a href="#cb9-82" aria-hidden="true" tabindex="-1"></a>            data[<span class="ss">f"Close_Lag</span><span class="sc">{</span>lag<span class="sc">}</span><span class="ss">"</span>] <span class="op">=</span> data[<span class="ss">f"Close_Lag</span><span class="sc">{</span>lag<span class="sc">}</span><span class="ss">"</span>].fillna(method<span class="op">=</span><span class="st">"ffill"</span>).fillna(method<span class="op">=</span><span class="st">"bfill"</span>)</span>
<span id="cb9-83"><a href="#cb9-83" aria-hidden="true" tabindex="-1"></a>            data[<span class="ss">f"Volume_Lag</span><span class="sc">{</span>lag<span class="sc">}</span><span class="ss">"</span>] <span class="op">=</span> data[<span class="ss">f"Volume_Lag</span><span class="sc">{</span>lag<span class="sc">}</span><span class="ss">"</span>].fillna(<span class="dv">0</span>)</span>
<span id="cb9-84"><a href="#cb9-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-85"><a href="#cb9-85" aria-hidden="true" tabindex="-1"></a>        <span class="co"># === Generate target variables ===</span></span>
<span id="cb9-86"><a href="#cb9-86" aria-hidden="true" tabindex="-1"></a>        data[<span class="st">"Target"</span>] <span class="op">=</span> np.where(data[<span class="st">"Close"</span>].shift(<span class="op">-</span><span class="dv">5</span>) <span class="op">&gt;</span> data[<span class="st">"Close"</span>], <span class="dv">1</span>, <span class="dv">0</span>)  <span class="co"># Binary target</span></span>
<span id="cb9-87"><a href="#cb9-87" aria-hidden="true" tabindex="-1"></a>        data[<span class="st">"Future_Return_5D"</span>] <span class="op">=</span> data[<span class="st">"Close"</span>].shift(<span class="op">-</span><span class="dv">5</span>) <span class="op">/</span> data[<span class="st">"Close"</span>] <span class="op">-</span> <span class="dv">1</span>  <span class="co"># 5-day future return</span></span>
<span id="cb9-88"><a href="#cb9-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-89"><a href="#cb9-89" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Fill target variables</span></span>
<span id="cb9-90"><a href="#cb9-90" aria-hidden="true" tabindex="-1"></a>        data[<span class="st">"Target"</span>] <span class="op">=</span> data[<span class="st">"Target"</span>].fillna(<span class="op">-</span><span class="dv">1</span>)  <span class="co"># Mark missing targets as -1</span></span>
<span id="cb9-91"><a href="#cb9-91" aria-hidden="true" tabindex="-1"></a>        data[<span class="st">"Future_Return_5D"</span>] <span class="op">=</span> data[<span class="st">"Future_Return_5D"</span>].fillna(<span class="dv">0</span>)</span>
<span id="cb9-92"><a href="#cb9-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-93"><a href="#cb9-93" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Reset index</span></span>
<span id="cb9-94"><a href="#cb9-94" aria-hidden="true" tabindex="-1"></a>        data.reset_index(inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb9-95"><a href="#cb9-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-96"><a href="#cb9-96" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Check for any remaining missing values</span></span>
<span id="cb9-97"><a href="#cb9-97" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> data.isnull().values.<span class="bu">any</span>():</span>
<span id="cb9-98"><a href="#cb9-98" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">"Warning: There are still missing values after processing:"</span>)</span>
<span id="cb9-99"><a href="#cb9-99" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(data.isnull().<span class="bu">sum</span>())</span>
<span id="cb9-100"><a href="#cb9-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-101"><a href="#cb9-101" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> data</span>
<span id="cb9-102"><a href="#cb9-102" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb9-103"><a href="#cb9-103" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Error cleaning data: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb9-104"><a href="#cb9-104" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb9-105"><a href="#cb9-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-106"><a href="#cb9-106" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">"__main__"</span>:</span>
<span id="cb9-107"><a href="#cb9-107" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Define date range</span></span>
<span id="cb9-108"><a href="#cb9-108" aria-hidden="true" tabindex="-1"></a>    start_date <span class="op">=</span> <span class="st">"2000-11-01"</span></span>
<span id="cb9-109"><a href="#cb9-109" aria-hidden="true" tabindex="-1"></a>    end_date <span class="op">=</span> <span class="st">"2024-11-30"</span></span>
<span id="cb9-110"><a href="#cb9-110" aria-hidden="true" tabindex="-1"></a>    date_range <span class="op">=</span> pd.date_range(start<span class="op">=</span>start_date, end<span class="op">=</span>end_date, freq<span class="op">=</span><span class="st">"D"</span>)</span>
<span id="cb9-111"><a href="#cb9-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-112"><a href="#cb9-112" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Process raw files in the folder</span></span>
<span id="cb9-113"><a href="#cb9-113" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> file_name <span class="kw">in</span> os.listdir(raw_data_folder):</span>
<span id="cb9-114"><a href="#cb9-114" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> file_name.endswith(<span class="st">"_raw_a.csv"</span>):</span>
<span id="cb9-115"><a href="#cb9-115" aria-hidden="true" tabindex="-1"></a>            asset_name <span class="op">=</span> file_name.replace(<span class="st">"_raw_a.csv"</span>, <span class="st">""</span>)</span>
<span id="cb9-116"><a href="#cb9-116" aria-hidden="true" tabindex="-1"></a>            raw_file_path <span class="op">=</span> os.path.join(raw_data_folder, file_name)</span>
<span id="cb9-117"><a href="#cb9-117" aria-hidden="true" tabindex="-1"></a>            raw_data <span class="op">=</span> pd.read_csv(raw_file_path)</span>
<span id="cb9-118"><a href="#cb9-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-119"><a href="#cb9-119" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Clean and process the data</span></span>
<span id="cb9-120"><a href="#cb9-120" aria-hidden="true" tabindex="-1"></a>            cleaned_data <span class="op">=</span> clean_and_process_data(raw_data, date_range)</span>
<span id="cb9-121"><a href="#cb9-121" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> cleaned_data <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb9-122"><a href="#cb9-122" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Save cleaned data</span></span>
<span id="cb9-123"><a href="#cb9-123" aria-hidden="true" tabindex="-1"></a>                processed_file_path <span class="op">=</span> os.path.join(output_folder_cleaned, <span class="ss">f"</span><span class="sc">{</span>asset_name<span class="sc">}</span><span class="ss">_cleaned.csv"</span>)</span>
<span id="cb9-124"><a href="#cb9-124" aria-hidden="true" tabindex="-1"></a>                cleaned_data.to_csv(processed_file_path, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb9-125"><a href="#cb9-125" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="ss">f"Cleaned data for </span><span class="sc">{</span>asset_name<span class="sc">}</span><span class="ss"> saved to '</span><span class="sc">{</span>processed_file_path<span class="sc">}</span><span class="ss">'."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/var/folders/1z/n1k_hhl168s2rqld4kqxxr880000gn/T/ipykernel_78435/3783961959.py:59: FutureWarning: Series.fillna with 'method' is deprecated and will raise in a future version. Use obj.ffill() or obj.bfill() instead.
  data["Close"] = data["Close"].fillna(method="ffill").fillna(method="bfill")
/var/folders/1z/n1k_hhl168s2rqld4kqxxr880000gn/T/ipykernel_78435/3783961959.py:60: FutureWarning: Series.fillna with 'method' is deprecated and will raise in a future version. Use obj.ffill() or obj.bfill() instead.
  data["Open"] = data["Open"].fillna(method="ffill").fillna(method="bfill")
/var/folders/1z/n1k_hhl168s2rqld4kqxxr880000gn/T/ipykernel_78435/3783961959.py:61: FutureWarning: Series.fillna with 'method' is deprecated and will raise in a future version. Use obj.ffill() or obj.bfill() instead.
  data["High"] = data["High"].fillna(method="ffill").fillna(method="bfill")
/var/folders/1z/n1k_hhl168s2rqld4kqxxr880000gn/T/ipykernel_78435/3783961959.py:62: FutureWarning: Series.fillna with 'method' is deprecated and will raise in a future version. Use obj.ffill() or obj.bfill() instead.
  data["Low"] = data["Low"].fillna(method="ffill").fillna(method="bfill")
/var/folders/1z/n1k_hhl168s2rqld4kqxxr880000gn/T/ipykernel_78435/3783961959.py:68: FutureWarning: Series.fillna with 'method' is deprecated and will raise in a future version. Use obj.ffill() or obj.bfill() instead.
  data["MA_50"] = data["MA_50"].fillna(method="ffill")
/var/folders/1z/n1k_hhl168s2rqld4kqxxr880000gn/T/ipykernel_78435/3783961959.py:69: FutureWarning: Series.fillna with 'method' is deprecated and will raise in a future version. Use obj.ffill() or obj.bfill() instead.
  data["MA_200"] = data["MA_200"].fillna(method="ffill")
/var/folders/1z/n1k_hhl168s2rqld4kqxxr880000gn/T/ipykernel_78435/3783961959.py:85: FutureWarning: Series.fillna with 'method' is deprecated and will raise in a future version. Use obj.ffill() or obj.bfill() instead.
  data[f"Close_Lag{lag}"] = data[f"Close_Lag{lag}"].fillna(method="ffill").fillna(method="bfill")</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Cleaned data for Gold saved to '/Users/qqmian/Desktop/GU_5000/Stock_Market_Performance/data/processed-data/Gold_cleaned.csv'.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>/var/folders/1z/n1k_hhl168s2rqld4kqxxr880000gn/T/ipykernel_78435/3783961959.py:59: FutureWarning: Series.fillna with 'method' is deprecated and will raise in a future version. Use obj.ffill() or obj.bfill() instead.
  data["Close"] = data["Close"].fillna(method="ffill").fillna(method="bfill")
/var/folders/1z/n1k_hhl168s2rqld4kqxxr880000gn/T/ipykernel_78435/3783961959.py:60: FutureWarning: Series.fillna with 'method' is deprecated and will raise in a future version. Use obj.ffill() or obj.bfill() instead.
  data["Open"] = data["Open"].fillna(method="ffill").fillna(method="bfill")
/var/folders/1z/n1k_hhl168s2rqld4kqxxr880000gn/T/ipykernel_78435/3783961959.py:61: FutureWarning: Series.fillna with 'method' is deprecated and will raise in a future version. Use obj.ffill() or obj.bfill() instead.
  data["High"] = data["High"].fillna(method="ffill").fillna(method="bfill")
/var/folders/1z/n1k_hhl168s2rqld4kqxxr880000gn/T/ipykernel_78435/3783961959.py:62: FutureWarning: Series.fillna with 'method' is deprecated and will raise in a future version. Use obj.ffill() or obj.bfill() instead.
  data["Low"] = data["Low"].fillna(method="ffill").fillna(method="bfill")
/var/folders/1z/n1k_hhl168s2rqld4kqxxr880000gn/T/ipykernel_78435/3783961959.py:68: FutureWarning: Series.fillna with 'method' is deprecated and will raise in a future version. Use obj.ffill() or obj.bfill() instead.
  data["MA_50"] = data["MA_50"].fillna(method="ffill")
/var/folders/1z/n1k_hhl168s2rqld4kqxxr880000gn/T/ipykernel_78435/3783961959.py:69: FutureWarning: Series.fillna with 'method' is deprecated and will raise in a future version. Use obj.ffill() or obj.bfill() instead.
  data["MA_200"] = data["MA_200"].fillna(method="ffill")
/var/folders/1z/n1k_hhl168s2rqld4kqxxr880000gn/T/ipykernel_78435/3783961959.py:85: FutureWarning: Series.fillna with 'method' is deprecated and will raise in a future version. Use obj.ffill() or obj.bfill() instead.
  data[f"Close_Lag{lag}"] = data[f"Close_Lag{lag}"].fillna(method="ffill").fillna(method="bfill")</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Cleaned data for Nasdaq saved to '/Users/qqmian/Desktop/GU_5000/Stock_Market_Performance/data/processed-data/Nasdaq_cleaned.csv'.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>/var/folders/1z/n1k_hhl168s2rqld4kqxxr880000gn/T/ipykernel_78435/3783961959.py:59: FutureWarning: Series.fillna with 'method' is deprecated and will raise in a future version. Use obj.ffill() or obj.bfill() instead.
  data["Close"] = data["Close"].fillna(method="ffill").fillna(method="bfill")
/var/folders/1z/n1k_hhl168s2rqld4kqxxr880000gn/T/ipykernel_78435/3783961959.py:60: FutureWarning: Series.fillna with 'method' is deprecated and will raise in a future version. Use obj.ffill() or obj.bfill() instead.
  data["Open"] = data["Open"].fillna(method="ffill").fillna(method="bfill")
/var/folders/1z/n1k_hhl168s2rqld4kqxxr880000gn/T/ipykernel_78435/3783961959.py:61: FutureWarning: Series.fillna with 'method' is deprecated and will raise in a future version. Use obj.ffill() or obj.bfill() instead.
  data["High"] = data["High"].fillna(method="ffill").fillna(method="bfill")
/var/folders/1z/n1k_hhl168s2rqld4kqxxr880000gn/T/ipykernel_78435/3783961959.py:62: FutureWarning: Series.fillna with 'method' is deprecated and will raise in a future version. Use obj.ffill() or obj.bfill() instead.
  data["Low"] = data["Low"].fillna(method="ffill").fillna(method="bfill")
/var/folders/1z/n1k_hhl168s2rqld4kqxxr880000gn/T/ipykernel_78435/3783961959.py:68: FutureWarning: Series.fillna with 'method' is deprecated and will raise in a future version. Use obj.ffill() or obj.bfill() instead.
  data["MA_50"] = data["MA_50"].fillna(method="ffill")
/var/folders/1z/n1k_hhl168s2rqld4kqxxr880000gn/T/ipykernel_78435/3783961959.py:69: FutureWarning: Series.fillna with 'method' is deprecated and will raise in a future version. Use obj.ffill() or obj.bfill() instead.
  data["MA_200"] = data["MA_200"].fillna(method="ffill")
/var/folders/1z/n1k_hhl168s2rqld4kqxxr880000gn/T/ipykernel_78435/3783961959.py:85: FutureWarning: Series.fillna with 'method' is deprecated and will raise in a future version. Use obj.ffill() or obj.bfill() instead.
  data[f"Close_Lag{lag}"] = data[f"Close_Lag{lag}"].fillna(method="ffill").fillna(method="bfill")</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Cleaned data for Crude_Oil saved to '/Users/qqmian/Desktop/GU_5000/Stock_Market_Performance/data/processed-data/Crude_Oil_cleaned.csv'.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>/var/folders/1z/n1k_hhl168s2rqld4kqxxr880000gn/T/ipykernel_78435/3783961959.py:59: FutureWarning: Series.fillna with 'method' is deprecated and will raise in a future version. Use obj.ffill() or obj.bfill() instead.
  data["Close"] = data["Close"].fillna(method="ffill").fillna(method="bfill")
/var/folders/1z/n1k_hhl168s2rqld4kqxxr880000gn/T/ipykernel_78435/3783961959.py:60: FutureWarning: Series.fillna with 'method' is deprecated and will raise in a future version. Use obj.ffill() or obj.bfill() instead.
  data["Open"] = data["Open"].fillna(method="ffill").fillna(method="bfill")
/var/folders/1z/n1k_hhl168s2rqld4kqxxr880000gn/T/ipykernel_78435/3783961959.py:61: FutureWarning: Series.fillna with 'method' is deprecated and will raise in a future version. Use obj.ffill() or obj.bfill() instead.
  data["High"] = data["High"].fillna(method="ffill").fillna(method="bfill")
/var/folders/1z/n1k_hhl168s2rqld4kqxxr880000gn/T/ipykernel_78435/3783961959.py:62: FutureWarning: Series.fillna with 'method' is deprecated and will raise in a future version. Use obj.ffill() or obj.bfill() instead.
  data["Low"] = data["Low"].fillna(method="ffill").fillna(method="bfill")
/var/folders/1z/n1k_hhl168s2rqld4kqxxr880000gn/T/ipykernel_78435/3783961959.py:68: FutureWarning: Series.fillna with 'method' is deprecated and will raise in a future version. Use obj.ffill() or obj.bfill() instead.
  data["MA_50"] = data["MA_50"].fillna(method="ffill")
/var/folders/1z/n1k_hhl168s2rqld4kqxxr880000gn/T/ipykernel_78435/3783961959.py:69: FutureWarning: Series.fillna with 'method' is deprecated and will raise in a future version. Use obj.ffill() or obj.bfill() instead.
  data["MA_200"] = data["MA_200"].fillna(method="ffill")
/var/folders/1z/n1k_hhl168s2rqld4kqxxr880000gn/T/ipykernel_78435/3783961959.py:85: FutureWarning: Series.fillna with 'method' is deprecated and will raise in a future version. Use obj.ffill() or obj.bfill() instead.
  data[f"Close_Lag{lag}"] = data[f"Close_Lag{lag}"].fillna(method="ffill").fillna(method="bfill")</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Cleaned data for S&amp;P_500 saved to '/Users/qqmian/Desktop/GU_5000/Stock_Market_Performance/data/processed-data/S&amp;P_500_cleaned.csv'.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>/var/folders/1z/n1k_hhl168s2rqld4kqxxr880000gn/T/ipykernel_78435/3783961959.py:59: FutureWarning: Series.fillna with 'method' is deprecated and will raise in a future version. Use obj.ffill() or obj.bfill() instead.
  data["Close"] = data["Close"].fillna(method="ffill").fillna(method="bfill")
/var/folders/1z/n1k_hhl168s2rqld4kqxxr880000gn/T/ipykernel_78435/3783961959.py:60: FutureWarning: Series.fillna with 'method' is deprecated and will raise in a future version. Use obj.ffill() or obj.bfill() instead.
  data["Open"] = data["Open"].fillna(method="ffill").fillna(method="bfill")
/var/folders/1z/n1k_hhl168s2rqld4kqxxr880000gn/T/ipykernel_78435/3783961959.py:61: FutureWarning: Series.fillna with 'method' is deprecated and will raise in a future version. Use obj.ffill() or obj.bfill() instead.
  data["High"] = data["High"].fillna(method="ffill").fillna(method="bfill")
/var/folders/1z/n1k_hhl168s2rqld4kqxxr880000gn/T/ipykernel_78435/3783961959.py:62: FutureWarning: Series.fillna with 'method' is deprecated and will raise in a future version. Use obj.ffill() or obj.bfill() instead.
  data["Low"] = data["Low"].fillna(method="ffill").fillna(method="bfill")
/var/folders/1z/n1k_hhl168s2rqld4kqxxr880000gn/T/ipykernel_78435/3783961959.py:68: FutureWarning: Series.fillna with 'method' is deprecated and will raise in a future version. Use obj.ffill() or obj.bfill() instead.
  data["MA_50"] = data["MA_50"].fillna(method="ffill")
/var/folders/1z/n1k_hhl168s2rqld4kqxxr880000gn/T/ipykernel_78435/3783961959.py:69: FutureWarning: Series.fillna with 'method' is deprecated and will raise in a future version. Use obj.ffill() or obj.bfill() instead.
  data["MA_200"] = data["MA_200"].fillna(method="ffill")
/var/folders/1z/n1k_hhl168s2rqld4kqxxr880000gn/T/ipykernel_78435/3783961959.py:85: FutureWarning: Series.fillna with 'method' is deprecated and will raise in a future version. Use obj.ffill() or obj.bfill() instead.
  data[f"Close_Lag{lag}"] = data[f"Close_Lag{lag}"].fillna(method="ffill").fillna(method="bfill")</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Cleaned data for Dow_Jones saved to '/Users/qqmian/Desktop/GU_5000/Stock_Market_Performance/data/processed-data/Dow_Jones_cleaned.csv'.</code></pre>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>